"""
    StepInterface IMPLEMENTATION CLASS DEFINITION for generating from a va scan vulnerability report
    an enhanced processed vulnerability .xlsx file, including additional information.
    Each step implementation class do a single specific operation.
    The order in which step implementation classes are called is , for some steps, mandatory and
    driven by the main in va_enrich_report_generator.py file
"""

from step_definition.step_interface import StepInterface


class StepMergeLinesOnTool(StepInterface):
    """ This class merge lines on tools columns (Found In)
    """

    def execute(self):
        """
        Base class abstract method implementation.
        Execute the operation expected for this step class
        """
        self._logger.info(
            "STEP %d: merge lines on tool and clean before generating output file",
            self._step_num)
        va_scan_table__final = self._step_data.get_curr_va_report_df
        all_columns = list(va_scan_table__final)
        all_columns.remove('Found in')
        merge_lines_on_tool = va_scan_table__final.groupby(all_columns)['Found in'].apply(' - '.join).reset_index()
        self._step_data.set_va_report_data(merge_lines_on_tool)
        self._logger.debug("Final VA table %s", merge_lines_on_tool.count)
        merge_lines_on_tool = merge_lines_on_tool.filter(regex=r'^(?!(.*Unnamed:.*$))')
        self._step_data.set_va_report_data(merge_lines_on_tool)

