"""
    StepInterface IMPLEMENTATION CLASS DEFINITION for generating from a va scan vulnerability report
    an enhanced processed vulnerability .xlsx file, including additional information.
    Each step implementation class do a single specific operation.
    The order in which step implementation classes are called is , for some steps, mandatory and
    driven by the main in va_enrich_report_generator.py file
"""
import lib.utility_lib as Util
import pandas as pd

from step_definition.step_interface import StepInterface


class StepRemoveDuplicated(StepInterface):
    """
    Remove duplicates after exchanging multiple CVE-REF with single CVE in VID column.
    WARNING: This step has to be executed after the StepSwapCveWithVid
    """

    @Util.strict_types
    def __step__remove_duplicates(self, va_scan_table: pd.DataFrame):
        df_step_size = len(va_scan_table)
        self._logger.info("Size va_scan_table: %d", df_step_size)
        va_scan_table.drop_duplicates(inplace=True)
        df_step_size_no_duplicates = len(va_scan_table)
        self._logger.info("Removed duplicates: %d", df_step_size - df_step_size_no_duplicates)
        self._logger.info("Size va_scan_table no duplicate: %d", df_step_size_no_duplicates)
        return va_scan_table

    def execute(self):
        """
        Base class abstract method implementation.
        Execute the operation expected for this step class
        """
        self._logger.info(
            "STEP %d: Remove duplicates for CVEs after swap", self._step_num)
        va_report_df = self._step_data.get_curr_va_report_df
        va_scan_report_drop_duplicate_cves_df = self.__step__remove_duplicates(va_report_df)
        self._step_data.set_va_report_data(va_scan_report_drop_duplicate_cves_df)
