# CVE Test Plan

[TOC]

## Precondition

Python version: 3.11.0

**Install:**

```text
pip install pytest
pip install pytest-html
```

## Run execution of tests

### launch

```text
python testsuite/MainTest.py
```

### Support cmd for launch single test or test cases

```text
standard: pytest --verbose --tb=long --junitxml=results.xml testsuite/<test_name.py>
with print: pytest -s --tb=long --junitxml=results.xml testsuite/<test_name.py>
```

## Testcases Information

### TestCase: Test for verifying delta calculation on current VA report when all JIRA(s) were handled during the previous sprint (no new JIRA to open)

**Test file:** testsuite/test_01_remove_matching_rows_columns.py

1. **Input:** testsuite/testData/cENM-va-report-for-jira.csv
2. **Name of the test function:** test_remove_matching_rows_different_columns_no_new_vulnerabilities_detection
3. **Tested function:** remove_rows_matching_on_columns_value

### TestCase: Test for verifying delta calculation works properly for each single row of a subset of VA reports generated in sprints N and N-1, logging potential errors for further (manual) analysis

**Test file:** testsuite/test_01_remove_matching_rows_columns.py

1. **Input:** testsuite/testData/cENM-va-report-for-jira.csv
2. **Name of the test function:** test_remove_matching_rows_different_columns_new_vulnerabilities_detection
3. **Tested function:** remove_rows_matching_on_columns_value
4. Output - In the event of an error, retrieves:
    * a. Input table sprint N in: outputData/va_repo_N_table_for-testcase2-error.csv
    * b. input table sprint N-1 in: outputData/va_repo_N_1_table_for-testcase2-error.csv
    * c. Unmatched results in: outputData/df_result_for-testcase2-error.csv

### TestCase: Test for verifying delta calculation on a sample subset of VA report(s) containing some patten* in order to put relevant case studies

**Test file:** testsuite/test_01_remove_matching_rows_columns.py

1. **Input:** testsuite/testData/cENM-va-report-for-test1-inputN.csv, testsuite/testData/cENM-va-report-for-test1-inputN-1.csv & testsuite/testData/exp-output-report-for-test1.csv.
2. **Name of the test function:** test_remove_matching_rows_different_columns_topic_vulnerabilities_detection
3. **Tested function:** remove_rows_matching_on_columns_value
4. Check: remove_rows_matching_on_different_columns function removes only the expected rows of the passed tables: inputTableN and inputTableN_1 according to expectedOutputTable input file

(*)  Sample Expected behavior for delta calculation with sample input rows :

```text
# 1. input Table N - Redundant key1 ; input Table N-1 key1 present ; Expected Result: key1 not present
# 2. input Table N - Redundant key1 ; input Table N-1 key1 not present; Expected Result: Redundant key1
# 3. input Table N - Not present key1 ; input Table N-1 key1 present ; Expected Result: key1 not present
# 4. input Table N - Single key1 ; input Table N-1 key1 not present; Expected Result: Single key1 present
# 5. input Table N - Single key1 ; input Table N-1 key1 present ; Expected Result: key1 not present
```

### TestCase: Test for removing base image rows from a subset of VA enhanced report, logging potential errors for further (manual) analysis

**Test file:** testsuite/test_01_remove_matching_rows_columns.py

1. **Input:** testsuite/testData/cENM-va-report-for-jira_clean.csv & base image
2. **Name of the test function:** test_remove_matching_rows_common_columns_erase_baseimage_from_va_enhanced_report
3. **Tested function:** utility_lib.remove_rows_matching_on_columns_value
4. Check: remove_rows_matching_on_columns_value function removes only the expected rows of the passed tables: inputTableN and inputTableN_1 according to expectedOutputTable input file
5. Output - In the event of an error, retrieves:
   * a. Input table in: outputData/va_report_enhanced_table_for-testcase4-error.csv"
   * b. input table in: outputData/base_image_table_for-testcase4-error.csv"
   * c. Unmatched results in: outputData/df_result_for-testcase4-error.csv"

```text
Note: Testcases in testsuite/test_01_remove_matching_rows_columns.py check that by passing a pair of data frames (df_n-1, df_n) and the relative lists of columns (that are the fields to check) as input parameters to the utility function "remove_rows_matching_on_columns_value,"
the function returns a df containing just the the rows, only once, found on df_n but not on df_n-1.
```

### Test case: Verify check for consistency by splitting the input table cENM-va-report-for-jira_clean.csv into a new_va_repo table with only critical severity data and a complimentary table

**Test file:** testsuite/test_02_StepFilterBySeverity.py

1. **Input:** testsuite/testData/empty_base_image.csv, testsuite/testData/cENM-va-report-for-jira_clean.csv.
2. **Name of the test function:** test_success_step_0
3. **Tested function:** StepFilterBySeverity
4. Check the output tables: process_discarded_rows_df and new_va_report must have the same number of rows as the input tables.

### Test case: Verify that expansion function explodes a sample table as described below

**Test file:** testsuite/test_03_StepExplode_va_report.py

1. **Input:** An appropriate sample table (placed in testsuite/testData)
2. **Name of the test function:** test_manipulate_rpm_packpath_with_model_table
3. **Tested function:** StepExpandRow
4. Check the condition determining the duplication of rows:
   * a. Package-Paths and Rpm-Package must have same number of '#', '|' | and in the same positions.
   * b. The number of '#' must be consistent with number of tools that detected the vulnerability
   * c. Only Package-Path can contain space as separator of path
   * d. Number of exploded or discarded rows are verified according to condition: { for each # or | or space in a row according to a, b, c → the row is duplicated. Otherwise the row is discarded }

### Test case: Verify that expansion function explodes a va_repo enhanced table as described below

**Test file:** testsuite/test_03_StepExplode_va_report.py

1. **Input:** testsuite/testData/All-images-final_report_proj-cENM-va_clean.csv
2. **Name of the test function:** test_manipulate_rpm_packpath_with_va_report
3. **Tested function:** StepExpandRow
4. Check the condition determining the duplication of rows:
   * a. Package-Paths and Rpm-Package must have same number of '#', '|' | and in the same positions.
   * b. The number of '#' must be consistent with number of tools that detected the vulnerability
   * c. Only Package-Path can contain space as separator of path
   * d. Number of exploded or discarded rows are verified according to condition: { for each # or | or space in a row according to a, b, c → the row is duplicated. Otherwise the row is discarded }

### Test case: After manipulating StepAddCxp, check that missing CXP is added in the va_report according to the profile in path_2_rpm_association.yml

**Test file:** testsuite/test_04_StepCXP_va_repo.py

1. **Input:** An appropriate sample table (placed in testsuite/testData)
2. **Name of the test function:** test_success_step_2
3. **Tested function:** StepAddCxp

### Test case: Check if RA, CNA info and Team columns are successfully merged in a new table created built from va_repo_table, sg_mapping_table, and cxp_table

**Test file:** testsuite/test_05_StepSG_va_repo.py

1. **Input:** An appropriate sample table (placed in testsuite/testData)
2. **Name of the test function:** test_success_step_add_team_ra_cna_partial_inputdata
3. **Tested function:** StepAddTeamRaCna

### Test case: Check if RA, CNA info, Team and Requirement_Area columns are successfully merged in a new table created built from va_repo_table, sg_mapping_table, and cxp_table

**Test file:** testsuite/test_05_StepSG_va_repo.py

1. **Input:** An appropriate sample table (placed in testsuite/testData)
2. **Name of the test function:** test_success_step_add_team_ra_cna_full_inputdata
3. **Tested function:** StepAddTeamRaCna

### Test case: Check if Column Reorder generates a table with expected number of rows

**Test file:** testsuite/test_06_StepSetTeamColumnAndReorder.py

1. **Input:** An appropriate sample table (placed testsuite/testData)
2. **Name of the test function:** test_success_StepSetTeamColumnReorder
3. **Tested function:** StepAddTeamRaCna

### Test case: Check that the table generated by csv_for_jira_generator:create_jira_ticket_df contains the expected columns

**Test file:** testsuite/test_07_cenm_cve_jira_csv.py

1. **Input:** An appropriate sample table (placed testsuite/testData)
2. **Name of the test function:** test_check_cve_jira_csv_columns
3. **Tested function:** csv_for_jira_generator.create_jira_ticket_df
4. Check if the output table contains the columns listed below:

```text
['Issue Type', 'Summary',  'Priority', 'Reporter', 'Description', 'Team name', 'RA', 'Component/s', 'Acceptance Criteria', 'Found in release', 'Epic Link']
```
